{"version":3,"sources":["../../src/index.js","App.js","index.js"],"names":["Quill","parentElement","quills","allowedOrigins","templates","useState","editing","setEditing","setCurrentData","setCurrentImageId","useEffect","window","Boolean","e","receivedMessage","evt","a","setInterval","addEditButton","highlightEditable","document","head","link","Array","el","dw","d","editorContainer","d2","d3","saveClicked","cancelClicked","createEditInput","editablesWrapper","createImageUpload","childrenElements","i","dm","minus","actionType","sections","getSections","identifier","index","id","plus","obj","constructArrayObj","console","m","singleQuillId","newText","extractElementContent","val","s","toolbarOptions","matchIndex","original_HTML","quill","modules","toolbar","theme","formats","App","allowedOrigin","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.9327532a.chunk.js","sourcesContent":["// This has been moved to npm package firestore-cms-iframe.\n\nimport React, {useEffect, useState, ReactDOM} from 'react';\n// This is shared code for all CMS listeners.\n// Listens to events from login.<domain-name>.craftie.xyz, \n// Edits the page after events are received.\nimport Quill from 'quill';\n// import ReactQuill from 'react-quill';\n// import 'react-quill/dist/quill.snow.css';\n// import htmlToText from 'html-to-text';\n\nQuill.prototype.getHTML = (parentElement) => {\n    return parentElement.querySelector('.ql-editor').innerHTML;\n};\n\nQuill.prototype.setHTML = (parentElement, html) => {\n    parentElement.querySelector('.ql-editor').innerHTML = html;\n}\n\nconst quills = {};\n// const original_innerHTMLs = {};\n\nexport default function CMS({\n    allowedOrigins,\n    templates,\n}){\n\n    const [editing, setEditing] = useState(/*TODO make this false */true);\n    // const [showEditor, setShowingEditor] = useState();\n    const [currentData, setCurrentData] = useState();\n    const [currentImageId, setCurrentImageId] = useState();\n    \n    useEffect(()=>{\n        // Listen to CMS websitecontent editing events.\n        window.addEventListener(\"message\", receivedMessage, false);\n\n        // TODO remove this, this is only to be prompted by the parent from Craftie.xyz.\n        // highlightEditable({origin: allowedOrigins, data: \"startEdit\"});\n        window.onclick = (e) => {\n            // console.log(\"something was clicked: \", e.target);\n            var isEditingContainer = Boolean(e.target.closest(\".cp-editable.editing\"));\n            if(isEditingContainer){\n                // console.log('BLOCKING');\n                e.preventDefault();\n                e.stopPropagation();\n            }\n            // if(e.target.classList.contains('ql-editor')){\n            //     e.preventDefault();\n            //     e.stopPropagation();\n            // }\n        }\n    }, []);\n\n    // Handles received messages from parent.\n    const receivedMessage = (evt) => {\n        // 'highlight'\n        if(!allowedOrigins.some(a => evt.origin.includes(a))) return;\n        // !evt.origin.includes(allowedOrigins)) return;\n        if(evt.data.actionType === \"initEditing\"){\n            setInterval(() => {\n                addEditButton();\n            }, 1000);\n        }\n        else if(evt.data.actionType === 'startEdit'){\n            highlightEditable();\n            setCurrentData(evt.data.websiteContent);\n        }\n        else if(evt.data.actionType === 'updateElement'){\n            // document.getElementById(currentFileId).classList.toggle('editing');\n            document.getElementById(evt.data.identifier).src = evt.data.file.url;\n        }\n        else if(evt.data.actionType === 'updateArray'){\n            setCurrentData(evt.data.newWebsiteContent);\n            window.location.reload();\n        }\n        \n        // else if(evt.data.actionType === 'cancelSaveFile'){\n        //     document.getElementById(currentFileId).classList.toggle('editing');\n        // }\n    }\n\n    useEffect(() => {\n        var head = document.head;\n        var link = document.createElement(\"link\");\n    \n        link.type = \"text/css\";\n        link.rel = \"stylesheet\";\n        link.href = \"https://cdn.quilljs.com/1.3.6/quill.snow.css\";\n    \n        head.appendChild(link);\n    \n        return () => { head.removeChild(link); }\n    }, []);\n\n    const addEditButton = () => {\n        // Text\n        const elements = Array.from(\n            document.querySelectorAll('.cp-editable')\n        );\n\n        for(var el of elements){\n            // Wrap in a div\n            // el.innerHTML = '<div>' + el.innerHTML + '</div>';\n\n            if(!el.querySelector('.cp-editable-btn')){\n                const dw = document.createElement('div');\n                dw.classList.add(\"cp-editable-btn-wrapper\");\n                const d = document.createElement('div');\n                const editorContainer = document.createElement('div');\n                d.textContent = \"Edit\";\n                // const img = document.createElement('img');\n                // img.src = \"\";\n                d.classList.add('cp-editable-btn');\n                editorContainer.classList.add('editor-wrapper');\n                \n                const d2 = document.createElement('div');\n                d2.textContent = \"Save\";\n                d2.classList.add('cp-editable-save-btn');\n                \n\n                const d3 = document.createElement('div');\n                d3.textContent = \"Cancel\";\n                d3.classList.add('cp-editable-cancel-btn');\n                \n                d2.onclick = (e) => {\n                    saveClicked(e);\n                }\n\n                d3.onclick = (e) => {\n                    cancelClicked(e);\n                }\n                \n                d.onclick = (e) => {\n                    createEditInput(e);\n                }\n\n                const editablesWrapper = document.createElement('div');\n                editablesWrapper.classList.add('editables-wrapper');\n                // Block clicks to the parent element.\n                editablesWrapper.onclick = (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                }\n                // el.appendChild(editorContainer);\n                dw.appendChild(d);\n                dw.appendChild(d2);\n                dw.appendChild(d3);\n                // el.appendChild(dw);\n                editablesWrapper.appendChild(editorContainer);\n                editablesWrapper.appendChild(dw);\n                el.appendChild(editablesWrapper);\n            }\n\n        }\n\n        // Images\n        const imgElements = Array.from(\n            document.querySelectorAll('.cp-editable-img')\n        );\n        for(var el of imgElements){\n            if(!el.parentElement.querySelector('.cp-editable-img-btn')){\n                el.parentElement.style.position = \"relative\";\n                const dw = document.createElement('div');\n                dw.classList.add(\"cp-editable-img-wrapper\");\n                const d = document.createElement('div');\n                d.textContent = \"Change Image\";\n\n                d.classList.add('cp-editable-img-btn');\n                \n                // const d2 = document.createElement('div');\n                // d2.textContent = \"Save\";\n                // d2.classList.add('cp-editable-img-save-btn');\n                \n                // const d3 = document.createElement('div');\n                // d3.textContent = \"Cancel\";\n                // d3.classList.add('cp-editable-img-cancel-btn');\n\n                // d2.onclick = (e) => {\n                //     saveImageClicked(e);\n                // }\n                // d3.onclick = (e) => {\n                //     cancelImageClicked(e);\n                // }\n                d.onclick = (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    createImageUpload(e);\n                }\n                dw.appendChild(d);\n                // dw.appendChild(d2);\n                // dw.appendChild(d3);\n                el.parentElement.insertBefore(dw, el.nextSibling);\n            }\n        }\n\n        // Lists\n        const arrayElements = Array.from(\n            document.querySelectorAll('.cp-editable-array')\n        );\n        for(var el of arrayElements){\n            if(!el.querySelector('.cp-editable-array-minus-wrapper')){\n                \n                // Put remove button on direct child div.\n                var childrenElements = Array.from(\n                    el.querySelectorAll(':scope > *:not(.cp-editable-array-plus-wrapper)')\n                );\n\n                for(var i=0;i<childrenElements.length;i++){\n                    const dm = document.createElement('div');\n                    dm.classList.add('cp-editable-array-minus-wrapper');\n                    const minus = document.createElement('div');\n                    minus.textContent = \"X\";// .innerHTML = \"&#9587;\";\n                    minus.classList.add('cp-editable-array-minus');\n                    minus.id = i;\n                    dm.style.position = \"relative\";\n                    dm.appendChild(minus);\n                    childrenElements[i].appendChild(dm);\n\n                    minus.onclick = (e) => {\n                        var parentElement = e.target.closest('.cp-editable-array');//e.target.parentElement.parentElement;\n                        window.parent.postMessage({\n                            actionType: 'removeFromArray',\n                            sections: getSections(parentElement.id),\n                            identifier: parentElement.id,\n                            index: e.target.id,\n                            // obj: constructArrayObj(e.target.parentElement)\n                        }, '*');\n                    }\n                }\n                el.style.position = \"relative\";\n            }\n            if(!el.querySelector('.cp-editable-array-plus')){\n                // Search only for direct children with :scope pseudo-class.\n                const dw = document.createElement('div');\n                dw.classList.add(\"cp-editable-array-plus-wrapper\");\n                const plus = document.createElement('div');\n                plus.textContent = \"+\";\n                plus.classList.add('cp-editable-array-plus');\n\n                dw.appendChild(plus);   \n                el.appendChild(dw);\n\n                plus.onclick = (e) => {\n                    // console.log(\"parentElement: \", e.target.closest('.cp-editable-array').querySelector('> *:not(.cp-editable-array-plus-wrapper)'));\n                    // Find first child that is not the plus div.\n                    var parentElement = e.target.parentElement;//e.target.closest('.cp-editable-array').querySelector('> *:not(.cp-editable-array-plus-wrapper)');//e.target.parentElement.parentElement;\n                    var obj = constructArrayObj(parentElement);\n                    window.parent.postMessage({\n                        actionType: 'addToArray',\n                        sections: getSections(parentElement.closest('.cp-editable-array').id),\n                        identifier: parentElement.closest('.cp-editable-array').id,\n                        obj: obj,\n                    }, '*');\n                }\n            }\n        }\n    }\n\n    // Provided with an element, construct an element by detecting all children types and creating them.\n    // These are found by looking for id's of the form 'asd-0-etc'\n    const constructArrayObj = (parentElement) => {\n        const singleInstance = [];\n        // console.log(parentElement)\n        // Find all elements with an 'id' attribute\n        // Assume that direct child is the right type.\n        // console.log(\"children: \", parentElement.closest('.cp-editable-array').querySelector(':scope > *'))\n        // var childElement = parentElement.closest('.cp-editable-array')\n            // .querySelector(':scope > *:not(.cp-editable-array-plus-wrapper)')\n            // .querySelector(':scope > .cp-editable')\n        // if(childElement){\n        //         //.querySelector(':scope > *:not(.cp-editable-array-plus-wrapper)')/*parentElement.firstChild*/);\n        //     for(var el of Array.from(childElement\n        //             // .closest('.cp-editable-array')\n        //             // .querySelector(':scope > *')\n        //             // .querySelector(':scope > *:not(.cp-editable-array-plus-wrapper)')\n        //             .querySelectorAll(\"[id]\"))){\n        //                 console.log('Found element: ', el);\n        //         if(!el.classList.contains(\"cp-editable-array-minus\")){\n        //             var m = el.id.match(/[a-zA-Z0-9]+$/);\n        //             console.log(m, m[0]);\n        //             singleInstance.push({\n        //                 type: el.tagName.toLowerCase(),\n        //                 value: m[0],\n        //             });\n        //         }\n        //     }\n        // } else {\n            // None exists, use template information\n            console.log('USING TEMPLATE] ', parentElement.closest('.cp-editable-array').id);\n            var m = parentElement.closest('.cp-editable-array').id.match(/[a-zA-Z0-9_]+$/);\n            return templates[m[0]];\n        // }\n        // console.log(singleInstance);\n        return singleInstance;\n        // for(var t of [\".cp-editable\",\".cp-editable-img\",\".cp-editable-array\"]){\n        //     for(var element of Array.from(parentElement.querySelectorAll(t))){\n\n        //     }\n        // }\n    }\n\n    const cancelClicked = (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        // Show all other \"edit\" buttons because prone to bugs when editing two at once.\n        Array.from(document.querySelectorAll('.cp-editable-btn')).forEach(el => {\n            el.style.display = \"block\";\n        });\n\n        var parentElement = e.target.closest('.cp-editable');\n        parentElement.classList.toggle('editing');\n        // quills[getCssSelector(parentElement)].setText(\"\");\n        // Manually hide\n        if(parentElement.querySelector('.ql-toolbar'))\n            parentElement.querySelector('.ql-toolbar').style.display = \"none\";\n        if(parentElement.querySelector('.ql-container'))\n            parentElement.querySelector('.ql-container').style.display = \"none\";\n        // Array.from(parentElement.querySelectorAll('.ql-toolbar'))\n        //     .forEach(el => el.style.display = \"none\")\n        // Array.from(parentElement.querySelectorAll('.ql-container'))\n        //     .forEach(el => el.style.display = \"none\")\n        \n        // quills[getCssSelector(parentElement)].disable();//enable(false);\n        // delete quills[getCssSelector(parentElement)];\n        // parentElement.textContent = quills[getCssSelector(parentElement)].getText();\n        // if (quills[getCssSelector(parentElement)]) {\n            // parentElement.innerHTML = quills[getCssSelector(parentElement)].getHTML();// + parentElement.innerHTML;\n            // parentElement.innerHTML = quills[parentElement.id].getHTML();\n        // }\n        // parentElement.innerHTML = original_innerHTMLs[parentElement.id];\n        \n        // // Redefine click events for buttons.\n        // Recreates everything.\n        addEditButton();\n    }\n\n    // Save this field to the DB\n    const saveClicked = async (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        // Show all other \"edit\" buttons because prone to bugs when editing two at once.\n        Array.from(document.querySelectorAll('.cp-editable-btn')).forEach(el => {\n            el.style.display = \"block\";\n        });\n\n        var parentElement = e.target.closest('.cp-editable');\n        var singleQuillId = parentElement.dataset.singleQuillId;\n        parentElement.classList.toggle('editing');\n\n        // Manually hide\n        parentElement.querySelector('.ql-toolbar').style.display = \"none\";\n        parentElement.querySelector('.ql-container').style.display = \"none\";\n        // Array.from(parentElement.querySelectorAll('.ql-toolbar'))\n        //     .forEach(el => el.style.display = \"none\")\n        // Array.from(parentElement.querySelectorAll('.ql-container'))\n        //     .forEach(el => el.style.display = \"none\")\n        \n        // Update local DOM\n        // Update local dom as pure text?\n        // htmlToText\n        // var quill = quills[getCssSelector(parentElement)];\n        // var currentText = quills[getCssSelector(parentElement)].getHTML();//document.querySelector('.ql-editor').textContent;//Not working => quill.getText();\n        var newText;\n        if(singleQuillId){\n            newText = quills[singleQuillId].getHTML(parentElement);//document.querySelector('.ql-editor').textContent;//Not working => quill.getText();\n        } else {\n            newText = quills[parentElement.id].getHTML(parentElement);//document.querySelector('.ql-editor').textContent;//Not working => quill.getText();\n        }\n\n        // parentElement.textContent = currentText;\n        // parentElement.innerHTML = currentText;\n        // parentElement.innerHTML = original_innerHTMLs[parentElement.id];\n\n        const dbObj = currentData;\n        var sections = parentElement.id.split(/-|~/g);\n        // sections.unshift(\"obj\");\n        var val = extractElementContent(parentElement);\n\n        window.parent.postMessage({\n            actionType: 'finishedEdit',\n            sections: sections,\n            val: newText,//val,\n        }, '*');\n\n        addEditButton();\n    }\n\n    // const saveImageClicked = () => {\n    //     // var parentElement = e.target.parentElement.previousElementSibling;\n    //     // parentElement.classList.toggle('editing');\n    //     document.getElementById(currentImageId).classList.toggle('editing');\n    //     // Update local DOM\n    //     var sections = currentImageId.split(/-|~/g);\n\n    //     console.log('SENDING Save Image: ', sections, currentFile);\n    //     window.parent.postMessage({\n    //         actionType: 'editFile',\n    //         sections: sections,\n    //         file: currentFile,\n    //         identifier: currentImageId,\n    //     }, '*');\n\n    //     addEditButton();\n    // }\n\n    const getSections = (s) => {\n        var a = s.split(/-|~/g);\n        return a;\n    }\n\n    const createImageUpload = (e) => {\n        var el = e.target;\n        var parentElement = el.parentElement.previousElementSibling;//closest('.cp-editable-img');\n        console.log(\"variables: \", el, parentElement, parentElement.id);\n        parentElement.classList.toggle('editing');\n        // setCurrentFile(imageId);\n        setCurrentImageId(parentElement.id);\n        // setShowingImageUploader(true);\n        window.parent.postMessage({\n            actionType: 'editFile',\n            sections: getSections(parentElement.id),\n            identifier: parentElement.id,\n        }, '*');\n    }\n\n    const extractElementContent = (el) => {\n        // var matchIndex = el.innerHTML.indexOf('<div class=\"editor-wrapper\"');\n        // var firstText = el.innerHTML;//.substring(0, matchIndex);\n        return el.innerHTML;//firstText;//el.textContent.replace(/EditSaveCancel/,'');\n    }\n\n\n    const toolbarOptions = [\n        [{ 'header': [2, false] }],\n        // [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown\n        ['bold', 'italic', 'underline', 'strike'],        // toggled buttons\n        ['blockquote', /*'code-block'*/'link'],\n      \n        // [{ 'header': 1 }, { 'header': 2 }],               // custom button values\n        [{ 'list': 'ordered'}, { 'list': 'bullet' }],\n        // [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript\n        // [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent\n        // [{ 'direction': 'rtl' }],                         // text direction\n      \n        // [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme\n        // [{ 'font': [] }],\n        [{ 'align': [] }],\n      \n        // ['clean']                                         // remove formatting button\n    ];\n\n    const createEditInput = (e) => {\n        var el = e.target;\n        // Kills onclick() events, so has to be placed first.\n        e.preventDefault();\n        e.stopPropagation();\n        var parentElement = el.closest('.cp-editable');\n        parentElement.classList.toggle('editing');\n\n        // Hide all other \"edit\" buttons because prone to bugs when editing two at once.\n        Array.from(document.querySelectorAll('.cp-editable-btn')).forEach(el => {\n            el.style.display = \"none\";\n        });\n        \n        // // var m = parentElement.innerHTML.match(/^[^<]*/);\n        // var m = parentElement.innerHTML.match(/.+?(?=<div class=\"editor\")/s);\n        // var currentText = m[0].trim();\n        // var regexp = new RegExp(m[0]);\n        // var matchIndex = parentElement.innerHTML.indexOf('<div class=\"editor-wrapper\"');\n        var matchIndex = parentElement.innerHTML.indexOf('<div class=\"editables-wrapper\"');\n        // var innerText;\n        \n        var original_HTML = parentElement.innerHTML.substring(0, matchIndex);\n        var singleQuillId = undefined;\n\n        if(parentElement.dataset.content){\n            original_HTML = parentElement.dataset.content;\n        }\n        console.log(\"original_HTML: \", original_HTML);\n        // Only uses one quill that is shared\n        if(parentElement.dataset.singleQuillId){\n            singleQuillId = parentElement.dataset.singleQuillId;\n        }\n\n        // original_innerHTMLs[parentElement.id] = original_HTML;\n        // console.log('innerText: ', original_HTML);\n        // console.log(\"firstText: \", firstText);\n        // var secondText = parentElement.innerHTML.substring(matchIndex);\n        // console.log('firstText: ', firstText);\n\n        // var inp = document.createElement(\"input\");\n        if(!parentElement.querySelector('.ql-toolbar')){\n            // if(innerText){\n            //     parentElement.innerHTML = parentElement.innerHTML.replace(innerText, '');    \n            // } else {\n                // parentElement.innerHTML = parentElement.innerHTML.replace(original_HTML, '');\n            // }\n            // original_innerHTMLs[parentElement.id] = original_HTML;\n            var quill = new Quill(parentElement.querySelector('.editor-wrapper'), { //getCssSelector(parentElement)\n                modules: { toolbar: toolbarOptions },\n                theme: 'snow',\n                formats: ['bold','header','italic','blockquote','indent','link','strike','script','underline','list','direction','align','image','video'],\n            });\n            // var currentText = parentElement.innerHTML;//.replace(/EditSaveCancel$/,'');\n             // Match until the first <, which denotes HTML postfixes.\n            // currentText = m[0].trim();\n            \n            // quill.setText(currentText);\n            // quill.setHTML(currentText);\n            // parentElement.innerHTML = parentElement.innerHTML.replace(regexp, '');\n            quill.setHTML(parentElement, original_HTML);\n\n            // parentElement.innerHTML = secondText;\n\n            if(singleQuillId){\n                quills[singleQuillId] = quill;\n            } else {\n                quills[parentElement.id] = quill;\n            }\n        } else {\n            \n            // var currentText = parentElement.textContent;\n            // currentText = currentText.replace(/EditSaveCancel$/,'');\n            // currentText = m[0].trim();\n            // var replaceText = new RegExp(currentText + \"EditSaveCancel\");\n            // parentElement.innerHTML = parentElement.innerHTML.replace(regexp, '');\n            // parentElement.innerHTML = parentElement.innerHTML.replace(original_HTML, '');\n            // parentElement.innerHTML = secondText;\n            // quills[getCssSelector(parentElement)].setHTML(firstText);\n\n            // Editor doesn't exist for special types e.g. react-select, where multiple fields use the same parent.\n            // Parent has Quill but children don't.\n\n            // if (!quills[parentElement.id]) {\n            //     var quill = new Quill(parentElement.querySelector('.editor-wrapper'), { //getCssSelector(parentElement)\n            //         modules: { toolbar: toolbarOptions },\n            //         theme: 'snow',\n            //         formats: ['bold','header','italic','blockquote','indent','link','strike','script','underline','list','direction','align','image','video'],\n            //     });\n            //     quill.setHTML(original_HTML);\n            //     quills[parentElement.id] = quill;\n            // }\n            // Editor already exists, just show it.\n            parentElement.querySelector('.ql-toolbar').style.display = \"block\";\n            parentElement.querySelector('.ql-container').style.display = \"block\";\n            if(singleQuillId){\n                quills[singleQuillId].setHTML(parentElement, original_HTML);\n            } else {\n                console.log(parentElement.id);\n                quills[parentElement.id].setHTML(parentElement, original_HTML);\n            }\n            // console.log(\"quill: \", quills[parentElement.id]);\n            // quills[getCssSelector(parentElement)].setText(currentText);\n        }\n\n        // Redefine click events for buttons.\n        parentElement.querySelector('.cp-editable-cancel-btn').onclick = (e) => {\n            cancelClicked(e);\n        }\n        parentElement.querySelector('.cp-editable-save-btn').onclick = (e) => {\n            saveClicked(e);\n        }\n        // const toolbar = document.createElement('div');\n        // toolbar.innerHTML = `<div id=\"toolbar\">\n        //     <button class=\"ql-bold\">Bold</button>\n        //     <button class=\"ql-italic\">Italic</button>\n        // </div>`;\n\n        // parentElement.appendChild(toolbar);\n        // parentElement.appendChild(editor);\n    }\n\n\n\n    const highlightEditable = () => {\n        if(!editing)\n            setEditing(true);\n\n        addEditButton();\n\n        // Attach CSS to head\n        document.head.insertAdjacentHTML('beforeend', `\n            <style>\n                .cp-editable {\n                    border: 2px solid black;\n                    position: relative;;\n                }\n                .cp-editable.editing {\n                    pointer-events: all!important;\n                    visibility: hidden;\n                }\n                .cp-editable.editing > div {\n                    pointer-events: all!important;\n                    visibility: visible;\n                }\n                .cp-editable::after {\n                    content: \"\";\n                    background-color: rgba(0,0,0,0.1);\n                    position: absolute;\n                    bottom: 0;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    pointer-events: none;\n                }\n                .cp-editable.editing::after {\n                    opacity: 0;\n                }\n                .cp-editable:hover .cp-editable-btn-wrapper {\n                    opacity: 1;\n                }\n                .cp-editable-btn-wrapper {\n                    opacity: 0;\n                    position: absolute;\n                    /* box-shadow: 0px 0px 2px rgba(255,255,255,0.5); */\n                    z-index: 1;\n                    /* right: 0; */\n                    right: 0;\n                    pointer-events: all;\n                    /* top: 5px; */\n                    /* top: -15px; */\n                    bottom: 0px;\n                    display: flex;\n                    justify-content: space-evenly;\n                    align-items: center;\n                    transition: all 100ms ease-in-out;\n                }\n                .cp-editable-btn,\n                .cp-editable-save-btn,\n                .cp-editable-cancel-btn {\n                    background-color: black;\n                    color: white;\n                    padding: 2px 6px;\n                    /* width: 50px; */\n                    font-size: 12px!important;\n                    font-weight: 200!important;\n                    border-radius: 4px;\n                    border: 1px solid rgba(150,150,150,0.5);\n                    cursor: pointer;\n                    line-height: normal;\n                    margin-left: 5px;\n                    text-align: center;\n                }\n                .cp-editable-btn:hover,\n                .cp-editable-save-btn:hover,\n                .cp-editable-cancel-btn:hover,\n                .cp-editable-img-cancel-btn:hover,\n                .cp-editable-img-save-btn:hover,\n                .cp-editable-img-btn:hover {\n                    background-color: rgb(50,50,50);\n                }\n                .cp-editable.editing .cp-editable-btn,\n                .cp-editable-img.editing .cp-editable-img-btn {\n                    display: none;\n                }\n                .cp-editable .cp-editable-save-btn,\n                .cp-editable .cp-editable-cancel-btn,\n                .cp-editable-img .cp-editable-img-cancel-btn,\n                .cp-editable-img .cp-editable-img-save-btn {\n                    display: none;\n                }\n                .cp-editable.editing .cp-editable-save-btn,\n                .cp-editable.editing .cp-editable-cancel-btn,\n                .cp-editable-img-btn.editing .cp-editable-img-cancel-btn,\n                .cp-editable-img-btn.editing .cp-editable-img-save-btn {\n                    display: block;\n                }\n\n                .ql-editor {\n                    white-space: normal;\n                }\n\n                .ql-toolbar, \n                .editor-wrapper,\n                .ql-editor,\n                .ql-editor * {\n                    background-color: white!important;\n                    color: black!important;\n                    line-height: normal!important;\n                    text-align: initial!important;\n                }\n\n                /* White space is weird in editor, so set to default */\n                .ql-editor p, \n                .ql-editor h2 {\n                    margin: 1em 0!important;\n                }\n\n                .cp-editable-img-btn {\n                    position: relative;\n                    border: 2px solid black;\n                    background-color: black;\n                    color: white;\n                    white-space: nowrap;\n                    padding: 2px 4px;\n                    width: fit-content;\n                    font-size: 12px;\n                    border-radius: 4px;\n                    border: 1px solid rgba(150,150,150,0.5);\n                    cursor: pointer;\n                    line-height: normal;\n                    font-weight: 200;\n                    margin-left: 5px;\n                }\n                .cp-editable-img-wrapper {\n                    position: absolute;\n                    z-index: 1;\n                    right: 0;\n                    bottom: 5px;\n                    display: flex;\n                    justify-content: space-evenly;\n                    align-items: center;\n                    transition: all 100ms ease-in-out;\n                }\n\n                .cp-editable-array-minus-wrapper {\n                    position: relative;\n                }\n                .cp-editable-array-minus {\n                    position: absolute;\n                    bottom: 5px;\n                    left: 5px;\n                    /*top: 50%;*/\n                    /*transform: translateY(-50%);*/\n                    border: 1px solid rgba(150,150,150,0.5);\n                    border-radius: 4px;\n                    font-size: 20px;\n                    background-color: black;\n                    font-weight: 800;\n                    line-height: 20px;\n                    padding: 5px 10px;\n                    color: white;\n                    cursor: pointer;\n                }\n                .cp-editable-array-plus-wrapper {\n                    position: absolute;\n                    left: 35px;\n                    bottom: 0px;\n                }\n                .cp-editable-array-plus {\n                    position: absolute;\n                    bottom: -35px;\n                    right: 0px;\n                    background-color: black;\n                    border: 1px solid rgba(150,150,150,0.5);\n                    border-radius: 4px;\n                    font-size: 25px;\n                    color: white;\n                    font-weight: 800;\n                    line-height: 20px;\n                    padding: 5px 10px;\n                    cursor: pointer;\n\n                }\n                .cp-editable-array-plus:hover ,\n                .cp-editable-array-minus:hover {\n                    opacity: .75;\n                }\n\n                /* Set defaults */\n                svg {\n                    color: initial!important;\n                    transition: initial!important;\n                    cursor: initial!important;\n                    margin-right: initial!important;\n                    margin-top: initial!important;\n                    height: initial!important;\n                    display: initial!important;\n                    padding: initial!important;\n                    padding-right: initial!important;\n                }\n            </style>\n        `)\n    }\n\n    return \"\";\n}\n\n\n","import React from 'react'\n\nimport CMS from 'firestore-cms-iframe'\n\nconst App = () => {\n  return <CMS allowedOrigin=\"<example-domain.com>\" templates={{}} />\n}\n\nexport default App\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}